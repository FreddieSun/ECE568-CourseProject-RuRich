<!DOCTYPE html>
<!-- saved from url=(0053)https://getbootstrap.com/docs/4.0/examples/dashboard/ -->
<html lang="en" class="gr__getbootstrap_com">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="https://getbootstrap.com/favicon.ico">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <title>Dashboard Template for Bootstrap</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
          integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">

    <!-- Custom styles for this template -->
    <link href="./Dashboard Template for Bootstrap_files/dashboard.css" rel="stylesheet">

    <!--share.js-->
    <link rel="stylesheet" href="dist/css/share.min.css">
    <script src="dist/js/social-share.min.js"></script>

    <style type="text/css">/* Chart.js */
    @-webkit-keyframes chartjs-render-animation {
        from {
            opacity: 0.99
        }
        to {
            opacity: 1
        }
    }

    @keyframes chartjs-render-animation {
        from {
            opacity: 0.99
        }
        to {
            opacity: 1
        }
    }

    .chartjs-render-monitor {
        -webkit-animation: chartjs-render-animation 0.001s;
        animation: chartjs-render-animation 0.001s;
    }</style>

</head>


<body data-gr-c-s-loaded="true">
<nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0">

    <ul class="navbar-nav px-3">
        <li class="nav-item text-nowrap">
            <a class="nav-link">Stock Prediction</a>
        </li>
    </ul>
</nav>

<div class="container-fluid">
    <div class="row">
        <nav class="col-md-2 d-none d-md-block bg-light sidebar">
            <div class="sidebar-sticky">
                <ul class="nav flex-column">

                    <!--左边的sidebar-->
                    <li class="nav-item">
                        <a class="nav-link" onclick=changeName("GOOG","stockName"); href="#">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round" class="feather feather-bar-chart-2">
                                <line x1="18" y1="20" x2="18" y2="10"></line>
                                <line x1="12" y1="20" x2="12" y2="4"></line>
                                <line x1="6" y1="20" x2="6" y2="14"></line>
                            </svg>
                            GOOG<p id="GOOG_value">123</p>
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" onclick=changeName("AABA","stockName"); href="#">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round" class="feather feather-bar-chart-2">
                                <line x1="18" y1="20" x2="18" y2="10"></line>
                                <line x1="12" y1="20" x2="12" y2="4"></line>
                                <line x1="6" y1="20" x2="6" y2="14"></line>
                            </svg>
                            AABA<p id="AABA_value">123</p>
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" onclick=changeName("FB","stockName"); href="#">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round" class="feather feather-bar-chart-2">
                                <line x1="18" y1="20" x2="18" y2="10"></line>
                                <line x1="12" y1="20" x2="12" y2="4"></line>
                                <line x1="6" y1="20" x2="6" y2="14"></line>
                            </svg>
                            FB<p id="FB_value">123</p>
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" onclick=changeName("MSFT","stockName"); href="#">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round" class="feather feather-bar-chart-2">
                                <line x1="18" y1="20" x2="18" y2="10"></line>
                                <line x1="12" y1="20" x2="12" y2="4"></line>
                                <line x1="6" y1="20" x2="6" y2="14"></line>
                            </svg>
                            MSFT<p id="MSFT_value">123</p>
                        </a>
                    </li>


                    <li class="nav-item">
                        <a class="nav-link" onclick=changeName("TWTR","stockName"); href="#">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round" class="feather feather-bar-chart-2">
                                <line x1="18" y1="20" x2="18" y2="10"></line>
                                <line x1="12" y1="20" x2="12" y2="4"></line>
                                <line x1="6" y1="20" x2="6" y2="14"></line>
                            </svg>
                            TWTR<p id="TWTR_value">123</p>
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" onclick=changeName("AAPL","stockName"); href="#">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round" class="feather feather-bar-chart-2">
                                <line x1="18" y1="20" x2="18" y2="10"></line>
                                <line x1="12" y1="20" x2="12" y2="4"></line>
                                <line x1="6" y1="20" x2="6" y2="14"></line>
                            </svg>
                            AAPL<p id="AAPL_value">123</p>
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" onclick=changeName("JPM","stockName"); href="#">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round" class="feather feather-bar-chart-2">
                                <line x1="18" y1="20" x2="18" y2="10"></line>
                                <line x1="12" y1="20" x2="12" y2="4"></line>
                                <line x1="6" y1="20" x2="6" y2="14"></line>
                            </svg>
                            JPM<p id="JPM_value">123</p>
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" onclick=changeName("AMZN","stockName"); href="#">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round" class="feather feather-bar-chart-2">
                                <line x1="18" y1="20" x2="18" y2="10"></line>
                                <line x1="12" y1="20" x2="12" y2="4"></line>
                                <line x1="6" y1="20" x2="6" y2="14"></line>
                            </svg>
                            AMZN<p id="AMZN_value">123</p>
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" onclick=changeName("JNJ","stockName"); href="#">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round" class="feather feather-bar-chart-2">
                                <line x1="18" y1="20" x2="18" y2="10"></line>
                                <line x1="12" y1="20" x2="12" y2="4"></line>
                                <line x1="6" y1="20" x2="6" y2="14"></line>
                            </svg>
                            JNJ<p id="JNJ_value">123</p>
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" onclick=changeName("BAC","stockName"); href="#">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                 stroke-linejoin="round" class="feather feather-bar-chart-2">
                                <line x1="18" y1="20" x2="18" y2="10"></line>
                                <line x1="12" y1="20" x2="12" y2="4"></line>
                                <line x1="6" y1="20" x2="6" y2="14"></line>
                            </svg>
                            BAC<p id="BAC_value">123</p>
                        </a>
                    </li>

                </ul>


            </div>
        </nav>
        <main role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
            <div class="chartjs-size-monitor"
                 style="position: absolute; left: 0px; top: 0px; right: 0px; bottom: 0px; overflow: hidden; pointer-events: none; visibility: hidden; z-index: -1;">
                <div class="chartjs-size-monitor-expand"
                     style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;">
                    <div style="position:absolute;width:1000000px;height:1000000px;left:0;top:0"></div>
                </div>
                <div class="chartjs-size-monitor-shrink"
                     style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;">
                    <div style="position:absolute;width:100%;height:100%;left:0; top:0"></div>
                </div>
            </div>
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
                <h1 class="h2" id="stockName">Dashboard</h1><h1 class="h2" id="peroidType">Peroid Type: Year</h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <div class="btn-group mr-2">

                        <!--           <button class="btn btn-sm btn-outline-secondary">Share</button>
                          <button class="btn btn-sm btn-outline-secondary">Export</button> -->
                        <div class="social-share" data-initialized="true">
                            <a href="#" class="social-share-icon icon-twitter"></a>
                            <a href="#" class="social-share-icon icon-google"></a>
                            <a href="#" class="social-share-icon icon-linkedin"></a>
                        </div>

                    </div>

                    <div class="dropdown">
                        <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown"
                                id="indictor">Long Term
                        </button>
                        <ul class="dropdown-menu">
                            <li><a href="#" onclick=changeTerm("long","indictor")>Long Term</a></li>
                            <li><a href="#" onclick=changeTerm("short","indictor")>Short Term</a></li>

                        </ul>
                    </div>


                    <div class="dropdown">
                        <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown"
                                id="peroid">Year
                        </button>
                        <ul class="dropdown-menu">
                            <li><a href="#"
                                   onclick=changePeroid("Year","peroid")>Year</a></li>
                            <li><a href="#"
                                   onclick=changePeroid("Month","peroid")>Month</a></li>
                            <li><a href="#"
                                   onclick=changePeroid("Day","peroid")>Day</a></li>
                        </ul>
                    </div>

                </div>

            </div>
            <!--chart-->
            <h2>Chart:</h2>
            <div id="draw">
                <!--       <canvas class="my-4 chartjs-render-monitor" id="myChart" width="1538" height="648" style="display: block; width: 1538px; height: 649px;"></canvas> -->
                <canvas id="myChart"></canvas>
            </div>
            <!--Additional information-->
            <h2>Stock Info</h2>
            <div class="table-responsive">
                <table class="table table-striped table-sm">
                    <thead>
                    <tr>
                        <th>Info</th>
                        <th>Value</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>Highest stock price in last ten days</td>
                        <td id="High">0</td>
                    </tr>
                    <tr>
                        <td>Average stock price in last one year</td>
                        <td id="Avg">0</td>
                    </tr>
                    <tr>
                        <td>Lowest stock price in last one year</td>
                        <td id="Low">0</td>
                    </tr>
                    <tr>
                        <td>Stock with lower average price than selected stock</td>
                        <td id="Loweravg">0</td>
                    </tr>
                    <tr>
                        <td>Advice for future:</td>
                        <td id="Advice"></td>
                    </tr>
                    </tbody>
                </table>
            </div>


            <!--Comments-->
            <hr/>
            <div>
                <div>
                    <h2>Comments:</h2>
                    <div id="comments">
                        <p>No comments yet.</p>
                    </div>
                </div>
            </div>
            <!--Add new comment-->
            <hr/>
            <div>
                <h3>New Comments:</h3>
                <div>

                    <div id="AddNewComments">
                        <form action="http://rurich.zwithc.cn/api/v0.1.0/stockresource/comment"
                              method="post">
                            <input id="submitSymbol" type='hidden' name='symbol' value='' readonly="readonly"/>
                            <br/>
                            Name:
                            <br/>
                            <input type='text' name='username'/>
                            <br/>
                            Comment:
                            <br/>
                            <textarea rows="10" cols="200" name='comment'/>
                            </textarea>
                            <br>
                            <input id="submitTime" type="hidden" name="timestamp" value="" readonly="readonly"/>
                            <br/>
                            <input type='submit' class="btn btn-sm btn-outline-secondary" value='submit'/>

                        </form>
                    </div>
                </div>
            </div>

        </main>


        <!-- Bootstrap core JavaScript
          ================================================== -->
        <!-- Placed at the end of the document so the pages load faster -->

        <script>window.jQuery || document.write('<script src="../../../../assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
        <script src="./Dashboard Template for Bootstrap_files/popper.min.js.下载"></script>
        <script src="./Dashboard Template for Bootstrap_files/bootstrap.min.js.下载"></script>

        <!-- Icons -->
        <script src="./Dashboard Template for Bootstrap_files/feather.min.js.下载"></script>
        <script>
            feather.replace()
        </script>

        <!-- Graphs -->
        <script src="./Dashboard Template for Bootstrap_files/Chart.min.js.下载"></script>
        <script>

            //function changePeroid(name)
            //{
            // if(name==“Year”)
            //document.getElementById("p1").innerText="You selected to use "+name+" units.";
            //if(name=="Month")
            //if(name=="Day")
            //}


            //Thresold
            var VRhigh = 160;//高于卖出
            var VRlow = 70;//低于买入

            var EMAhigh = 0;
            var EMAlow = 1;

            var MACDhigh = 0;
            var MACDlow = 0;

            //last price
            var lastPrice = 0;

            var stockName = "GOOG";
            var oringinalChartData = "";
            var High = "";
            var Avg = "";
            var Low = "";
            var Loweravg = "";
            var type = "year";

            var price = [];
            var volume = [];

            var LabelTime = [];

            var VRdata = [];
            var VRsingle = 1;

            var EMAdata = [];
            var EMAsingle = 1;

            var MACDdata = [];
            var MACDsingle = 1;

            var bayesData = [];
            var bayesSingle;

            var SVRData = [];
            var SVRSingle;

            var DNNData = [];
            var DNNSingle;

            var PredictData = [];
            var PredictSingle;

            var dayState;
            var lastTime;
            var term = "long";
            var originalCommentData;

            //start page
            changeName("GOOG", "stockName");

            function changeTerm(termTxt, id) {
                VRdata = "";
                VRdata = [];

                EMAdata = "";
                EMAdata = [];

                MACDdata = "";
                MACDdata = [];
                document.getElementById(id).innerText = termTxt;
                term = termTxt;
                updateAll(stockName, type);
            }

            function getPredict(Data) {
                var last = bayesData.length;
                console.log("last:" + last);

                console.log("last indictor: " + VRdata[last - 1] + " , " + EMAdata[last - 1] + " , " + MACDdata[last - 1]);
                getAdvice(VRdata[last - 1], EMAdata[last - 1], MACDdata[last - 1]);

                bayesData[last] = Data["result"]["predictor"][0]["price"];
                SVRData[last] = Data["result"]["predictor"][1]["price"];
                DNNData[last] = Data["result"]["predictor"][2]["price"];
                console.log("DNN: " + Data["result"]["predictor"][2]["price"]);
                PredictData[last] = Data["result"]["predictPrice"];
                redrawC();

            }

            function getEMA(Data) {
                EMAsingle = Data["result"]["data"];
                EMAdata.push(EMAsingle);
                console.log("getEMA:" + EMAsingle)
            }

            function getMACD(Data) {
                MACDsingle = Data["result"]["data"];
                MACDdata.push(MACDsingle);
                console.log("getMACD:" + MACDsingle);
                redrawC();
                var last = bayesData.length;
                console.log("last indictor: " + VRdata[last - 1] + " , " + EMAdata[last - 1] + " , " + MACDdata[last - 1]);
                getAdvice(VRdata[last - 1], EMAdata[last - 1], MACDdata[last - 1]);
            }

            function getVR(Data) {
                //console.log(Data)
                VRsingle = Data["result"]["data"];
                VRdata.push(VRsingle);
                console.log("getVR:" + VRsingle)
            }

            function comment(Data) {
                //console.log(Data);
                originalCommentData = Data;
            }

            function chart(Data) {
                //console.log(Data);
                oringinalChartData = Data;
            }

            function high(Data) {
                //console.log(Data);
                High = Data["value"]["max"];
            }

            function avg(Data) {
                //console.log(Data);
                Avg = Data["value"]["avg"];
            }

            function low(Data) {
                //console.log(Data);
                Low = Data["value"]["low"];
            }

            function lower(Data) {
                Loweravg = Data["Stock List"];
            }

            function changeName(name, id) {
                VRdata = "";
                VRdata = [];

                EMAdata = "";
                EMAdata = [];

                MACDdata = "";
                MACDdata = [];
                LabelTime = [];
                if (dayState != null)
                    window.clearInterval(dayState);
                type = "year";
                document.getElementById("peroidType").innerText = "Peroid Type: Year";
                document.getElementById("peroid").innerText = "Year";
                stockName = name;
                document.getElementById(id).innerText = name + "";
                document.getElementById("submitSymbol").value = name;
                var currentDate = new Date();
                var currentISO = currentDate.toISOString();
                document.getElementById("submitTime").value = currentISO;
                updateAll(name, type);
            }

            function updateAll(name, type) {
                //获取表格相关的原始数据
                update("http://rurich.zwithc.cn/api/v0.1.0/StockResource/" + name + "?type=" + type + "&__callback=chart");
                //console.log("http://localhost:8080/FinalProject/api/v0.1.0/StockResource/"+name+"?type="+type+"&__callback=chart")
                //获取Info相关的原始数据
                update("http://rurich.zwithc.cn/api/v0.1.0/StockResource/" + name + "?type=high&__callback=high");
                update("http://rurich.zwithc.cn/api/v0.1.0/StockResource/" + name + "?type=avg&__callback=avg");
                update("http://rurich.zwithc.cn/api/v0.1.0/StockResource/" + name + "?type=low&__callback=low");
                update("http://rurich.zwithc.cn/api/v0.1.0/StockResource/" + name + "?type=loweravg&__callback=lower");
                //获取评论区原始数据
                update("http://rurich.zwithc.cn/api/v0.1.0/StockResource/" + name + "?type=comment&__callback=comment");
                setTimeout(function () {
                    updateChart(oringinalChartData);
                    redrawC();
                }, 2000);
                setTimeout(function () {
                    updateInfo(High, Avg, Low, Loweravg)
                }, 1000);
                setTimeout(function () {
                    redrawComment(originalCommentData)
                }, 1000);
                //document.getElementById(id).innerText=name+"";
            }

            //修改peroid
            function updateVRdata(name, time) {
                // VRdata="";
                // VRdata=new Array();

                // EMAdata="";
                // EMAdata=new Array();

                // MACDdata="";
                // MACDdata=new Array();
                //console.log(time);
                for (var i = 0; i < time.length; i++) {
                    if (time[i] != "predict") {
                        //console.log("http://zwithc.cn:5001/api/v0.1.0/vr?symbol="+name+"&timestamp="+time[i]+"&jsonp_callback=getVR");
                        update("http://zwithc.cn:5001/api/v0.1.0/vr?symbol=" + name + "&timestamp=" + time[i] + "&jsonp_callback=getVR");
                        update("http://zwithc.cn:5001/api/v0.1.0/ema?symbol=" + name + "&timestamp=" + time[i] + "&jsonp_callback=getEMA");
                        update("http://zwithc.cn:5001/api/v0.1.0/macd?symbol=" + name + "&timestamp=" + time[i] + "&jsonp_callback=getMACD")
                    }
                }
                //console.log(VRdata);
            }

            function changePeroid(name, id) {
                VRdata = "";
                VRdata = [];

                EMAdata = "";
                EMAdata = [];

                MACDdata = "";
                MACDdata = [];
                LabelTime = [];
                if (dayState != null)
                    window.clearInterval(dayState);

                document.getElementById("peroidType").innerText="Peroid Type: "+name;

                document.getElementById(id).innerText = name + "";
                if (name == "Day") {
                    type = "day";
                    console.log("reachHere");
                    updateAll(stockName, "day");
                    dayState = setInterval(function () {
                        VRdata = "";
                        VRdata = [];

                        EMAdata = "";
                        EMAdata = [];

                        MACDdata = "";
                        MACDdata = [];
                        updateAll(stockName, "day");
                        console.log("N")
                    }, 40000);
                }
                if (name == "Month") {
                    type = "month";
                    updateAll(stockName, "month");
                }
                if (name == "Year") {
                    type = "year";
                    updateAll(stockName, "year");
                }
            }

            //转换时间，从EDT to ISO8601
            function convertTime(EDT) {
                var x = new Date(EDT);
                var ISO = x.toISOString();
                return ISO;

            }

            //股票清单
            var stockNameList = ["GOOG", "AABA", "FB", "MSFT", "TWTR", "AAPL", "JPM", "AMZN", "JNJ", "BAC"];

            //chart相关
            var setting = {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: false
                        }
                    }]
                },
                legend: {
                    display: false,
                },
                animation: {
                    duration: 0
                }
            };

            //更新表格
            //For chart1
            function updateChart(oringinalChartData) {
                var time = "";
                time = oringinalChartData["data"]["time"];
                //console.log(time);
                //显示的时间
                for (var i = 0; i < time.length; i++) {
                    if (time[i] != "predict")
                        time[i] = convertTime(time[i]);
                }
                time[time.length] = "predict";

                //label的time
                if (type != "day") {
                    for (var i = 0; i < time.length; i++) {
                        if (time[i] != "predict") {
                            LabelTime[i] = (new Date(time[i]).getFullYear() + "-" + (new Date(time[i]).getMonth() + 1) + "-" + new Date(time[i]).getDate());
                            LabelTime[i + 1] = "predict"
                        }

                    }
                }
                else {
                    for (var i = 0; i < time.length; i++) {
                        if (time[i] != "predict") {
                            LabelTime[i] = (new Date(time[i]).getHours() + ":" + new Date(time[i]).getMinutes() + ":" + new Date(time[i]).getSeconds());
                            LabelTime[i + 1] = "predict"
                        }
                    }
                }

                //更新VR
                updateVRdata(stockName, time);
                volume = oringinalChartData["data"]["volume"];
                price = oringinalChartData["data"]["price"];
                lastPrice = price[price.length - 1];
                for (var i = 0; i < volume.length; i++) {
                    volume[i] /= 100000;
                }
                //copy predict的原始数据
                console.log("price:" + price);
                bayesData = [];
                SVRData = [];
                DNNData = [];
                PredictData = [];

                bayesData[price.length - 2] = price[price.length - 2];
                SVRData[price.length - 2] = price[price.length - 2];
                PredictData[price.length - 2] = price[price.length - 2];
                DNNData[price.length - 2] = price[price.length - 2];

                bayesData[price.length - 1] = price[price.length - 1];
                SVRData[price.length - 1] = price[price.length - 1];
                PredictData[price.length - 1] = price[price.length - 1];
                DNNData[price.length - 1] = price[price.length - 1];

                // bayesData[price.length]=400;
                // SVRData[price.length]=500;
                // PredictData[price.length]=600;
                //console.log(bayesData)

                //更新predict
                setTimeout(function () {
                    if (term == "long") {
                        var date = new Date();
                        date = new Date(date.setDate(date.getDate() + 1));
                        var ISO = date.toISOString();
                        //time[time.length-1]=ISO;
                        update("http://zwithc.cn:5001/api/v0.1.0/predict?symbol=" + stockName + "&term=" + term + "&timestamp=" + ISO + "&jsonp_callback=getPredict")
                    }
                    else if (term == "short") {
                        var date = new Date();
                        date = new Date(date.setMinutes(date.getMinutes() + 1));
                        var ISO = date.toISOString();
                        //time[time.length-1]=ISO;
                        update("http://zwithc.cn:5001/api/v0.1.0/predict?symbol=" + stockName + "&term=" + term + "&timestamp=" + ISO + "&jsonp_callback=getPredict")
                    }
                }, 1000);

                //console.log(volume);
                console.log(VRdata);
            }

            function redrawC() {
                var newData = {
                    type: 'bar',
                    data: {
                        datasets: [{
                            label: "price",
                            data: price,
                            borderColor: '#007bff',
                            backgroundColor: 'transparent',
                            type: 'line'
                        },

                            {
                                label: "VR",
                                data: Object.values(VRdata),
                                borderColor: '#DE4525',
                                backgroundColor: 'transparent',
                                type: 'line'
                            },

                            {
                                label: "EMA",
                                data: Object.values(EMAdata),
                                borderColor: '#4DE813',
                                backgroundColor: 'transparent',
                                type: 'line'
                            }
                            ,
                            {
                                label: "MACD",
                                data: Object.values(MACDdata),
                                borderColor: '#E93DBD',
                                backgroundColor: 'transparent',
                                type: 'line'
                            },
                            {
                                label: "volume",
                                data: volume,
                                type: 'bar'
                            },
                            {
                                label: "Bayes",
                                data: bayesData,
                                borderColor: '#E93DBD',
                                backgroundColor: 'transparent',
                                type: 'line'
                            },
                            {
                                label: "SVR",
                                data: SVRData,
                                borderColor: '#4DE813',
                                backgroundColor: 'transparent',
                                type: 'line'
                            },
                            {
                                label: "DNN",
                                data: DNNData,
                                borderColor: '#000000',
                                backgroundColor: 'transparent',
                                type: 'line'
                            },
                            {
                                label: "PredictPrice",
                                data: PredictData,
                                borderColor: '#E900BD',
                                backgroundColor: 'transparent',
                                type: 'line'
                            }
                        ],
                        labels: LabelTime
                    },
                    options: setting
                };

                //console.log(newData);
                redrawChart(newData);
            }

            function redrawChart(newData) {
                var ctx = document.getElementById("myChart");
                //清空原来的canvas，重新绘图
                document.getElementById("myChart").remove();
                var ctx = document.createElement("canvas");
                ctx.setAttribute("class", "my-4 chartjs-render-monitor");
                ctx.setAttribute("id", "myChart");
                ctx.setAttribute("width", "1538");
                ctx.setAttribute("height", "648");
                ctx.setAttribute("style", "display: block; width: 1538px; height: 649px;");
                document.getElementById("draw").appendChild(ctx);
                //提供数值
                var myChart = new Chart(ctx, newData);
            }


            //载入评论内容
            function redrawComment(newData) {
                var commentList = newData["comment"];
                // if(commentList==null)
                // {
                //   document.getElementById('comments').innerHTML="<p>No comment yet</p>";
                //   return;
                // }
                document.getElementById('comments').innerHTML = "";
                for (var i = 0; i < commentList.length; i++) {
                    var current = document.createElement("div");
                    //console.log(current)
                    var h4 = document.createElement("h4");
                    h4.innerText = commentList[i]["username"] + " @ " + commentList[i]["timestamp"] + " said: ";
                    //console.log(h4)
                    var p = document.createElement("p");
                    p.innerText = commentList[i]["comment"];
                    var hr = document.createElement("hr");
                    current.appendChild(h4);
                    current.appendChild(p);
                    current.appendChild(hr);
                    document.getElementById("comments").appendChild(current);

                }
            }

            //更新单独的数据
            function updateInfo(High, Avg, Low, Loweravg) {
                High = parseFloat(High);
                High = High.toFixed(2);
                Avg = parseFloat(Avg);
                Avg = Avg.toFixed(2);
                Low = parseFloat(Low);
                Low = Low.toFixed(2);
                document.getElementById("High").innerText = High;
                document.getElementById("Avg").innerText = Avg;
                document.getElementById("Low").innerText = Low;
                document.getElementById("Loweravg").innerText = Loweravg;
            }

            function getAdvice(VRlast, EMAlast, MACDlast) {
                var resultArray = [];
                resultArray[0] = helpAdviceVR(VRlast, VRhigh, VRlow);
                resultArray[1] = helpAdviceEMA(EMAlast, EMAhigh, EMAlow);
                resultArray[2] = helpAdviceMACD(MACDlast, MACDhigh, MACDlow);

                console.log("resultArray: " + resultArray);

                var buy = 0;
                var hold = 0;
                var sell = 0;
                for (var x = 0; x < 3; x++) {
                    // console.log(resultArray[x])
                    if (resultArray[x] == "1")
                        buy++;
                    else if (resultArray[x] == "0")
                        hold++;
                    else if (resultArray[x] == "-1")
                        sell++;
                }
                console.log(buy + "," + hold + "," + sell);
                if (buy >= 2)
                    changeAdvice("buy");
                else if (hold >= 2)
                    changeAdvice("hold");
                else if (sell >= 2)
                    changeAdvice("sell");
                else
                    changeAdvice("hold")


            }

            function helpAdviceVR(Test, high, low) {
                if (Test <= low)
                    return "1";
                else if (Test <= high)
                    return "0";
                else if (Test > high)
                    return "-1";
            }

            function helpAdviceEMA(Test, high, low) {
                console.log("EMA Test: " + Test);
                console.log("last price" + lastPrice);
                Test = lastPrice - Test;
                if (Test >= 0)
                    return "1";
                else
                    return "-1";
            }

            function helpAdviceMACD(Test, high, low) {
                if (Test < low)
                    return "-1";
                else if (Test <= high)
                    return "0";
                else if (Test > high)
                    return "1";
            }

            function changeAdvice(value) {
                document.getElementById("Advice").innerText = value;
            }



            //更新left bar
            var price_GOOG = 0;
            var price_AABA = 0;
            var price_FB = 0;
            var price_MSFT = 0;
            var price_TWTR = 0;
            var price_AAPL = 0;
            var price_JPM = 0;
            var price_AMZN = 0;
            var price_JNJ = 0;
            var price_BAC = 0;

            function callback(data) {
                //console.log(data);
                price_GOOG = data[0]["price"];
                price_AABA = data[1]["price"];
                price_FB = data[2]["price"];
                price_MSFT = data[3]["price"];
                price_TWTR = data[4]["price"];
                price_AAPL = data[5]["price"];
                price_JPM = data[6]["price"];
                price_AMZN = data[7]["price"];
                price_JNJ = data[8]["price"];
                price_BAC = data[9]["price"];
                //document.getElementById("name").innerHTML = html;
            }

            function updateLeftBar() {
                document.getElementById("GOOG_value").innerText = price_GOOG;
                document.getElementById("AABA_value").innerText = price_AABA;
                document.getElementById("FB_value").innerText = price_FB;
                document.getElementById("MSFT_value").innerText = price_MSFT;
                document.getElementById("TWTR_value").innerText = price_TWTR;
                document.getElementById("AAPL_value").innerText = price_AAPL;
                document.getElementById("JPM_value").innerText = price_JPM;
                document.getElementById("AMZN_value").innerText = price_AMZN;
                document.getElementById("JNJ_value").innerText = price_JNJ;
                document.getElementById("BAC_value").innerText = price_BAC;
            }

            function update(url) {
                var script = document.createElement('script');
                script.setAttribute('src', url);
                document.getElementsByTagName('head')[0].appendChild(script);
            }

            setInterval(function () {
                update("http://rurich.zwithc.cn/api/v0.1.0/stockresource?__callback=callback");
                updateLeftBar()
            }, 4000);

            //Test Advice
            // setTimeout(function(){
            //     getAdvice(2,2,0.6)
            // },4000);

            //更新表格
            var StockName = "";
            var peroid = "";

        </script>


</body>
</html>